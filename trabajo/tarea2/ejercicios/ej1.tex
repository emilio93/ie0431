

\begin{ejercicio}
  \begin{enumerate}
    \item
    Se utiliza el teorema del valor final en la señal de error $e(s)$ cuando el controlador funciona como control regulatorio para obtener el error permanente $e_d(s)$.

    \begin{align*}
      e(s) &= r(s) - P(s)\left[d(s)+e(s) C(s)\right]
      \\ \tag{Señal de error}
      e(s) &= \frac{r(s) - P(s)d(s)}{1+C(s) P(s)}
      \\ \tag{Error de control regulatorio}
      e_d(s) &= \frac{-P(s) d(s)}{1+C(s)P(s)}
      \\ \tag{Teorema del valor final}
      e_{pd} &= \lim_{s\rightarrow 0} s e_d(s)
    \end{align*}

    Se sabe que en régimen permanente solo interesan las señales con frecuencia 0, debido a esto se pueden obviar los polos que no estén en el origen. Se utilizan las siguientes definiciones para controladores y procesos.
    \begin{align*}
      P(s) &= \frac{K}{s^{np}}P^{'}(s) & P^{'}(s) =& \frac{\Pi_{i=1}^{k}(T_i s +1)}{\Pi_{j=1}^{m}(T_j s +1)}
      \\
      C(s) &= \frac{K_p}{s^{nc}}C^{'}(s) & C^{'}(s) =& \frac{\Pi_{i=1}^{l}(T_i s +1)}{\Pi_{j=1}^{n}(T_j s +1)}
    \end{align*}

    \begin{align*}
      e_{pd} &= \lim_{s\rightarrow 0} s \frac{-\frac{K}{s^{np}}P^{'}(s) d(s)}
      {1+ \frac{K_p}{s^{nc}}C^{'}(s) \frac{K}{s^{np}}P^{'}(s)}
      \\
      e_{pd} &= \lim_{s\rightarrow 0} s \frac{-K P^{'}(s) d(s)}
      {s^{np} + s^{-nc} K_p K C^{'}(s) P^{'}(s)}
    \end{align*}

    Se utiliza una perturbación general del tipo $d(s)=d_m(s)=s^{-(1+m)}$.
    \begin{align*}
      e_{pdm} &= \lim_{s\rightarrow 0} s \frac{-K P^{'}(s) s^{-(1+m)}}
      {s^{np} + s^{-nc} K_p K C^{'}(s) P^{'}(s)}
      \\
      e_{pdm} &= \lim_{s\rightarrow 0} \frac{-K P^{'}(s)}
      {s^{m+np} + s^{m-nc} K_p K C^{'}(s) P^{'}(s)}
      \\ \tag{error permanente ante perturbación general}
      e_{pdm} &= \frac{-K}
      {\lim_{s\rightarrow 0}s^{m+np} + K_p K\lim_{s\rightarrow 0} s^{m-nc}}
    \end{align*}

    Ahora se puede tomar en cuenta distintos casos:
    \begin{itemize}
      \item Perturbación de tipo escalón unitario $d_m(s)=1/s$($m=0$). Proceso no integrante tipo 0($np=0$), controlador de tipo 0($nc=0$).
      \begin{align*}
        e_{pd0} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{0+0} + K_p K\lim_{s\rightarrow 0} s^{0-0}}
        = \frac{-K}{1 + K_p K}
      \end{align*}

      \item Perturbación de tipo escalón unitario $d_m(s)=1/s$($m=0$). Proceso no integrante tipo 0($np=0$), controlador de tipo 1($nc=1$).
      \begin{align*}
        e_{pd0} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{0+0} + K_p K\lim_{s\rightarrow 0} s^{0-1}}
        =
        \frac{-K}
        {1 + K_p K\lim_{s\rightarrow 0} {^1/_s}}
        =
        0
      \end{align*}
      \textit{Este resultado es válido para los casos en que el controlador sea de tipo 1 o mayor y se cumplan las condiciones de perturbación $d_m(s)$ con $m=0$ y proceso no integrante de tipo 0. Nótese más generalmente que cuando $m-nc<0$ se va a tener un término que tiende a infinito, esto hace que se tenga un $e_{pdm} = 0$, no hay error permanente.}

      \item
      Perturbación de tipo escalón unitario $d_m(s)=1/s$($m=0$). Proceso integrante tipo 1($np=1$), controlador de tipo 0($nc=0$).
      \begin{align*}
        e_{pd0} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{0+1} + K_p K\lim_{s\rightarrow 0} s^{0-0}}
        =
        \frac{-K}
        {\lim_{s\rightarrow 0}s + K_p K}
        =
        -\frac{1}{K_p}
      \end{align*}
      \textit{Este resultado es válido para los casos en que el proceso sea de tipo 1 o mayor y se cumplan las condiciones de perturbación $d_m(s)$ con $m=0$ y controlador tipo 0. En general, cuando $m+np>0, m-nc=0$ se va a tener error permanente finito.}

      \item
      Perturbación de tipo escalón unitario $d_m(s)=1/s$($m=0$). Proceso integrante tipo 1($np=1$), controlador de tipo 1($nc=1$).
      \begin{align*}
        e_{pd0} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{0+1} + K_p K\lim_{s\rightarrow 0} s^{0-1}}
        =
        \frac{-K}
        {0 + K_p K\lim_{s\rightarrow 0} {^1/_s}}
        =
        0
      \end{align*}
      \textit{Este resultado es válido para los casos en que el proceso sea de tipo 1 o mayor y se cumplan las condiciones de perturbación $d_m(s)$ con $m=0$ y controlador tipo 1. En general, cuando $m+np>0, m-nc<0$ no se va a tener error permanente finito.}

      \item
      Perturbación de tipo rampa $d_m(s)=1/s^2$($m=1$). Proceso integrante tipo 0($np=0$), controlador de tipo 0($nc=0$).
      \begin{align*}
        e_{pd1} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{1+0} + K_p K\lim_{s\rightarrow 0} s^{1-0}}
        =
        \frac{-K}
        {0 + K_p K\lim_{s\rightarrow 0} s} \rightarrow \infty
      \end{align*}
      \textit{Cuando $m\geq 1$, el primer término en el denominador se va a cancelar, por lo que el tipo de proceso no tiene efecto sobre el error permanente ante una perturbación de tipo rampa.}

      \item
      Perturbación de tipo rampa $d_m(s)=1/s^2$($m=1$). Cualquier tipo de proceso, controlador de tipo 1($nc=1$).
      \begin{align*}
        e_{pd1} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{1+np} + K_p K\lim_{s\rightarrow 0} s^{1-1}}
        =
        \frac{-1}{K_p}
      \end{align*}

          \item
      Perturbación de tipo rampa $d_m(s)=1/s^2$($m=1$). Cualquier tipo de proceso, controlador de tipo mayor a $m$($nc>m$).
      \begin{align*}
        e_{pd1} &= \frac{-K}
        {\lim_{s\rightarrow 0}s^{1+np} + K_p K\lim_{s\rightarrow 0} s^{1-nc}}
        =
        \frac{-K}
        {0 + K_p K\lim_{s\rightarrow 0} 1/s^{nc-1}} = 0
      \end{align*}

    \end{itemize}

    \item
    \begin{enumerate}
      \item 
      Se debe utilizar el error del controlador como servo.
      \begin{align*}
        \\ \tag{Error de control como servo}
        e_r(s) &= \frac{r(s)}{1+C(s)P(s)}
        \\ \tag{Teorema del valor final}
        e_{pr} &= \lim_{s\rightarrow 0} s e_r(s)
      \end{align*}

      Se obtiene la función para el valor deseado en el dominio de la frecuencia.
      \begin{align*}
        r(s) &= \mathcal{L} \left\{r(t)\right\} = \mathcal{L} \left\{2+t\right\} = \mathcal{L} \left\{2\right\} + \mathcal{L} \left\{t\right\} = \frac{2}{s} + \frac{1}{s^2} = \frac{2s + 1}{s^2}
      \end{align*}

      Se utiliza el proceso $P(s)=\frac{1}{s(s+2)}$ y el controlador $C(s)=K_p=10$.
      \begin{align*}
        e_{pr} &= \lim_{s\rightarrow 0} s \cdot \frac{2s+1}{s^2} \cdot \frac{1}{1+\frac{K_p}{s(s+2)}}
        =
        \lim_{s\rightarrow 0} s\frac{2s+1}{s+\frac{K_p}{s+2}}
        = \frac{2}{K_p} = \frac{2}{10}
        \\
        e_{pr} &= 0.2
      \end{align*}

      \item % b
      Ahora se debe tomar en cuenta la perturbación en el error permanente, como se calculó previamente, se tiene el caso $m=0$, $np=1$, $nc=0$.
      \begin{align*}
        e_p &= e_pr + e_pd = 0.2 + \frac{-1}{K_p} = 0.2 - \frac{1}{10} = 0.1
      \end{align*}

      \item % c
      Se obtienen los valores de $\zeta$ y $\omega_n$ en términos de $K_p$.
      \begin{align*}
        y(s) &= \frac{K_p}{s^2+2s+K_p} = \frac{K_{yr}\omega_n^2}{s^2+ 2\zeta \omega_n s + \omega_n^2}
        \\
        \omega_n^2 &= K_p
        \\
        \zeta^2 &= 1/K_p
        \\
        K_{yr} &= 1
      \end{align*}

      Se utiliza la fórmula para el sobrepaso máximo normalizado, se quiere que este sea de $0.15$, se despeja $K_p$ para este sobrepaso.
      \begin{align*}
        M_{pn} &= e^{-\pi\zeta/\sqrt{1-\zeta^2}}
        \\
        0.15 &= e^{-\pi/\sqrt{K_p(1-1/K_p)}} = e^{-\pi/\sqrt{K_p-1}}
        \\
        \ln(0.15)\sqrt{K_p-1} &= -\pi
        \\
        [\ln(0.15)]^2 (K_p-1) &= \pi^2
        \\
        K_p &= 1 + \frac{\pi^2}{[\ln(0.15)]^2}
        \\
        K_p &= 1 + \frac{\pi^2}{[\ln(0.15)]^2} \approx 3.7423
      \end{align*}

      \item % d
      \item % e
      $\quad$
      \begin{figure}[H]
        \centering
        \includegraphics[width=\textwidth]{tarea2/img/ej1-1.eps}
      \end{figure}
      \begin{figure}[H]
        \centering
        \includegraphics[width=\textwidth]{tarea2/img/ej1-2.eps}
      \end{figure}
    \end{enumerate}
  \end{enumerate}

\end{ejercicio}